{"ast":null,"code":"import { useRoute } from 'vue-router';\nimport { commonCartEffect } from '@/effects/cartEffects';\nimport { ref } from '@vue/reactivity';\nimport { post } from '@/utils/request';\nimport router from '@/router';\nimport { useStore } from 'vuex';\n\nconst useClickEffect = (shopId, shopName, productList) => {\n  const store = useStore();\n  const showBtn = ref(false);\n\n  const handleOrderClick = () => {\n    showBtn.value = !showBtn.value;\n  };\n\n  const handleComfirmClick = async isCanceled => {\n    // 点击确认支付，向接口发送数据，满足接口所需要的数据结构\n    // 假如成功的话，就跳转页面\n    const products = [];\n\n    for (let i in productList.value) {\n      let product = productList.value[i];\n      products.push({\n        id: parseInt(product._id, 10),\n        num: product.count\n      });\n      console.log(product);\n    }\n\n    try {\n      const result = await post('/api/order', {\n        addressId: 1,\n        shopId: parseInt(shopId, 10),\n        shopName: shopName.value,\n        isCanceled: isCanceled,\n        products: products\n      }); // console.log(result)\n\n      if (result?.errno === 0) {\n        store.commit('clearProductList', shopId);\n        router.push({\n          name: 'Home'\n        });\n      }\n    } catch (e) {\n      console.log('请求失败');\n    }\n  };\n\n  return {\n    handleComfirmClick,\n    showBtn,\n    handleOrderClick\n  };\n};\n\nexport default {\n  name: 'BottomView',\n\n  setup() {\n    const route = useRoute();\n    const shopId = route.params.id;\n    const {\n      caculations,\n      shopName,\n      productList\n    } = commonCartEffect(shopId);\n    const {\n      handleComfirmClick,\n      showBtn,\n      handleOrderClick\n    } = useClickEffect(shopId, shopName, productList);\n    return {\n      caculations,\n      handleComfirmClick,\n      showBtn,\n      handleOrderClick\n    };\n  }\n\n};","map":{"version":3,"mappings":"AA2BA,SAASA,QAAT,QAAyB,YAAzB;AACA,SAASC,gBAAT,QAAkC,uBAAlC;AACA,SAASC,GAAT,QAAoB,iBAApB;AACA,SAASC,IAAT,QAAqB,iBAArB;AACA,OAAOC,MAAP,MAAmB,UAAnB;AACA,SAASC,QAAT,QAAyB,MAAzB;;AAEA,MAAMC,cAAa,GAAI,CAACC,MAAD,EAASC,QAAT,EAAmBC,WAAnB,KAAiC;EACtD,MAAMC,KAAI,GAAIL,QAAQ,EAAtB;EACA,MAAMM,OAAM,GAAIT,GAAG,CAAC,KAAD,CAAnB;;EACA,MAAMU,gBAAe,GAAI,MAAI;IAC3BD,OAAO,CAACE,KAAR,GAAgB,CAACF,OAAO,CAACE,KAAzB;EACF,CAFA;;EAIA,MAAMC,kBAAiB,GAAI,MAAMC,UAAN,IAAmB;IAC5C;IACA;IACA,MAAMC,QAAO,GAAI,EAAjB;;IACA,KAAI,IAAIC,CAAR,IAAaR,WAAW,CAACI,KAAzB,EAAgC;MAC9B,IAAIK,OAAM,GAAIT,WAAW,CAACI,KAAZ,CAAkBI,CAAlB,CAAd;MACAD,QAAQ,CAACG,IAAT,CAAc;QACZC,EAAE,EAAEC,QAAQ,CAACH,OAAO,CAACI,GAAT,EAAc,EAAd,CADA;QAEZC,GAAG,EAAEL,OAAO,CAACM;MAFD,CAAd;MAIAC,OAAO,CAACC,GAAR,CAAYR,OAAZ;IACF;;IACA,IAAI;MACF,MAAMS,MAAK,GAAI,MAAMxB,IAAI,CAAC,YAAD,EAAc;QACrCyB,SAAS,EAAE,CAD0B;QAErCrB,MAAM,EAAEc,QAAQ,CAACd,MAAD,EAAS,EAAT,CAFqB;QAGrCC,QAAQ,EAAEA,QAAQ,CAACK,KAHkB;QAIrCE,UAAU,EAAEA,UAJyB;QAKrCC,QAAQ,EAAEA;MAL2B,CAAd,CAAzB,CADE,CAQF;;MACA,IAAGW,MAAM,EAAEE,KAAR,KAAkB,CAArB,EAAwB;QACtBnB,KAAK,CAACoB,MAAN,CAAa,kBAAb,EAAgCvB,MAAhC;QACAH,MAAM,CAACe,IAAP,CAAY;UAACY,IAAI,EAAE;QAAP,CAAZ;MACF;IACD,CAbD,CAaC,OAAMC,CAAN,EAAQ;MACPP,OAAO,CAACC,GAAR,CAAY,MAAZ;IACF;EACF,CA5BA;;EA6BA,OAAO;IACJZ,kBADI;IAEJH,OAFI;IAEKC;EAFL,CAAP;AAIF,CAxCA;;AAyCA,eAAe;EACbmB,IAAI,EAAE,YADO;;EAEbE,KAAK,GAAG;IACN,MAAMC,KAAI,GAAIlC,QAAQ,EAAtB;IACA,MAAMO,MAAK,GAAI2B,KAAK,CAACC,MAAN,CAAaf,EAA5B;IACA,MAAM;MAAEgB,WAAF;MAAe5B,QAAf;MAAyBC;IAAzB,IAAyCR,gBAAgB,CAACM,MAAD,CAA/D;IACA,MAAM;MAAEO,kBAAF;MAAsBH,OAAtB;MAA+BC;IAA/B,IAAoDN,cAAc,CAACC,MAAD,EAASC,QAAT,EAAmBC,WAAnB,CAAxE;IACA,OAAO;MACH2B,WADG;MAEHtB,kBAFG;MAEiBH,OAFjB;MAGHC;IAHG,CAAP;EAKF;;AAZa,CAAf","names":["useRoute","commonCartEffect","ref","post","router","useStore","useClickEffect","shopId","shopName","productList","store","showBtn","handleOrderClick","value","handleComfirmClick","isCanceled","products","i","product","push","id","parseInt","_id","num","count","console","log","result","addressId","errno","commit","name","e","setup","route","params","caculations"],"sourceRoot":"","sources":["C:\\Carrie\\VVVVVue\\jingdong\\src\\views\\order\\Bottom.vue"],"sourcesContent":["<template>\r\n<div class=\"order\">\r\n  <div class=\"order__price\">实付金额：<b>￥{{ caculations.price}}</b></div>\r\n  <div\r\n  @click=\"handleOrderClick\"\r\n  class=\"order__order\"\r\n  >提交订单</div>\r\n</div>\r\n<div class=\"mask\" v-show=\"showBtn\">\r\n  <div class=\"mask__content\">\r\n    <h3>确认要离开收银台？</h3>\r\n    <div class=\"mask__content__desc\">请尽快完成支付，否则将被取消</div>\r\n    <div class=\"mask__content__btns\">\r\n      <div\r\n      @click=\"()=>handleComfirmClick(true)\"\r\n      class=\"mask__content__btn\"\r\n      >取消订单</div>\r\n      <div\r\n      @click=\"()=>handleComfirmClick(false)\"\r\n      class=\"mask__content__btn\"\r\n      >确认支付</div>\r\n    </div>\r\n  </div>\r\n</div>\r\n</template>\r\n\r\n<script>\r\nimport { useRoute } from 'vue-router';\r\nimport { commonCartEffect  } from '@/effects/cartEffects';\r\nimport { ref } from '@vue/reactivity';\r\nimport { post } from '@/utils/request';\r\nimport router from '@/router';\r\nimport { useStore } from 'vuex';\r\n\r\nconst useClickEffect = (shopId, shopName, productList)=>{\r\n  const store = useStore()\r\n  const showBtn = ref(false)\r\n  const handleOrderClick = ()=>{\r\n    showBtn.value = !showBtn.value\r\n  }\r\n\r\n  const handleComfirmClick = async(isCanceled)=>{\r\n    // 点击确认支付，向接口发送数据，满足接口所需要的数据结构\r\n    // 假如成功的话，就跳转页面\r\n    const products = []\r\n    for(let i in productList.value) {\r\n      let product = productList.value[i]\r\n      products.push({\r\n        id: parseInt(product._id, 10),\r\n        num: product.count\r\n      })\r\n      console.log(product)\r\n    }\r\n    try {\r\n      const result = await post('/api/order',{\r\n        addressId: 1,\r\n        shopId: parseInt(shopId, 10),\r\n        shopName: shopName.value,\r\n        isCanceled: isCanceled,\r\n        products: products\r\n      })\r\n      // console.log(result)\r\n      if(result?.errno === 0) {\r\n        store.commit('clearProductList',shopId)\r\n        router.push({name: 'Home'})\r\n      }\r\n    }catch(e){\r\n      console.log('请求失败')\r\n    }\r\n  }\r\n  return {\r\n     handleComfirmClick,\r\n     showBtn, handleOrderClick\r\n  }\r\n}\r\nexport default {\r\n  name: 'BottomView',\r\n  setup() {\r\n    const route = useRoute();\r\n    const shopId = route.params.id;\r\n    const { caculations, shopName, productList } = commonCartEffect(shopId);\r\n    const { handleComfirmClick, showBtn, handleOrderClick } = useClickEffect(shopId, shopName, productList)\r\n    return {\r\n        caculations,\r\n        handleComfirmClick, showBtn,\r\n        handleOrderClick\r\n    };\r\n  }\r\n}\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import '../../style/viriables.scss';\r\n\r\n.order {\r\n  position: absolute;\r\n  display: flex;\r\n  bottom: 0;\r\n  left: 0;\r\n  right: 0;\r\n  line-height: .49rem;\r\n  height: .49rem;\r\n  background: $bgColor;\r\n  &__price {\r\n    flex: 1;\r\n    line-height: .49rem;\r\n    font-size: .14rem;\r\n    text-indent: .24rem;\r\n    color: $content-fontcolor;\r\n  }\r\n  &__order {\r\n    width: .98rem;\r\n    background: $btn-bgColor;\r\n    color: $bgColor;\r\n    font-size: .14rem;\r\n    text-align: center;\r\n  }\r\n}\r\n\r\n.mask {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  bottom: 0;\r\n  right: 0;\r\n  background: rgba(0, 0, 0, .5);\r\n  z-index: 1;\r\n  &__content {\r\n    position: absolute;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    background: $bgColor;\r\n    height: 1.52rem;\r\n    width: 2.97rem;\r\n    border-radius: 4px;\r\n    text-align: center;\r\n    h3 {\r\n      margin: .24rem auto 0 auto;\r\n      line-height: .25rem;\r\n      font-size: .18rem;\r\n    }\r\n    &__desc {\r\n      margin: .08rem auto .19rem auto;\r\n      line-height: .2rem;\r\n      font-size: .14rem;\r\n      color: $mid-fontColor;\r\n    }\r\n    &__btns {\r\n      display: flex;\r\n      justify-content: center;\r\n      align-items: center;\r\n    }\r\n    &__btn {\r\n      height: .32rem;\r\n      width: .8rem;\r\n      line-height: .31rem;\r\n      font-size: .14rem;\r\n      text-align: center;\r\n      border-radius: 16px;\r\n    }\r\n    &__btn:nth-child(1) {\r\n      border: 1px solid #4FB0F9;\r\n      color: $btn-bgColor;\r\n    }\r\n    &__btn:nth-child(2) {\r\n      margin-left: .24rem;\r\n      background: #4FB0F9;\r\n      border: 1px solid #4FB0F9;\r\n      color: white;\r\n    }\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}